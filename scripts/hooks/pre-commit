#!/bin/sh

# Check for staged PHP files
PHP_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.php$')

if [ -n "$PHP_FILES" ]; then
    echo "Running Pint on staged PHP files..."
    for FILE in $PHP_FILES; do
        ./vendor/bin/pint "$FILE"
        git add "$FILE"
    done
fi

# Check for staged TypeScript files
TS_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|vue)$')

if [ -n "$TS_FILES" ]; then
    echo "Running TypeScript type check on staged files..."
    npm run type-check:all
    if [ $? -ne 0 ]; then
        echo "❌ TypeScript type check failed. Please fix the errors before committing."
        exit 1
    fi
    echo "✅ TypeScript type check passed."
fi

exit 0
